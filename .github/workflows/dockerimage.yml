name: Docker Image CI

on:
  push:
    paths:
      - '*'
      - '!README.md'
      - '!push-tags.sh'
  pull_request:
    paths:
      - '*'
      - '!README.md'
      - '!push-tags.sh'


env:
  SE_VERSION: "4.38"
  SE_REVISION: "9760"
  BUILD_VERSION: "4.38-9760-rtm1"
  SHA256_SUM: "0216A1838ECD841F26AB1A8D34C6F9432E630CEE235926B119D6D981A2970AFB"


jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@master

      - name: Publish to Registry latest
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: wanrenzhizun/softether
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          tags: "${{ env.SE_VERSION }}-latest,${{SE_REVISION}}-latest"
          dockerfile: Dockerfile
          buildargs: BUILD_VERSION,SHA256_SUM

      - name: Publish to Registry centos
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: wanrenzhizun/softether
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          tags: "${{env.SE_VERSION}}-centos,${{SE_REVISION}}-centos"
          dockerfile: Dockerfile
          buildargs: BUILD_VERSION,SHA256_SUM

      - name: Publish to Registry alpine
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: wanrenzhizun/softether
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          tags: "${{env.SE_VERSION}}-alpine,${{SE_REVISION}}-alpine"
          dockerfile: Dockerfile.alpine
          buildargs: BUILD_VERSION,SHA256_SUM

      - name: Publish to Registry debian
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: wanrenzhizun/softether
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          tags: "${{env.SE_VERSION}}-debian,${{SE_REVISION}}-debian"
          dockerfile: Dockerfile.debian
          buildargs: BUILD_VERSION,SHA256_SUM

      - name: Publish to Registry ubuntu
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: wanrenzhizun/softether
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          tags: "${{env.SE_VERSION}}-ubuntu,${{SE_REVISION}}-ubuntu"
          dockerfile: Dockerfile.ubuntu
          buildargs: BUILD_VERSION,SHA256_SUM

